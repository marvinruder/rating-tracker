version: "3.8"

services:
  redis-test:
    image: redis:alpine
    user: 1000:1000
    cap_drop:
      - all
    security_opt:
      - no-new-privileges
    command: 'redis-server --appendonly no --save ""'
    ports:
      - 127.0.0.1:63791:6379

  postgres-test:
    image: postgres:alpine
    user: 70:70
    cap_drop:
      - all
    cap_add:
      - CHOWN
    security_opt:
      - no-new-privileges
    ports:
      - 127.0.0.1:54321:5432
    environment:
      POSTGRES_DB: "rating-tracker-test"
      POSTGRES_USER: "rating-tracker-test"
      POSTGRES_PASSWORD: "rating-tracker-test"
    volumes:
      - ../prisma/migrations:/docker-entrypoint-initdb.d/migrations:ro
      - ./all_migrations.sh:/docker-entrypoint-initdb.d/migrations.sh:ro
    shm_size: "256mb"
