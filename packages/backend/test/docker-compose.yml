version: "3.8"

services:
  postgres-test:
    image: postgres:alpine
    user: 70:70
    cap_drop:
      - all
    cap_add:
      - CHOWN
    security_opt:
      - no-new-privileges
    networks:
      default:
        ipv4_address: 10.114.116.112
    environment:
      POSTGRES_DB: "rating-tracker-test"
      POSTGRES_USER: "rating-tracker-test"
      POSTGRES_PASSWORD: "rating-tracker-test"
    volumes:
      - ../prisma/migrations:/docker-entrypoint-initdb.d/migrations:ro
      - ./all_migrations.sh:/docker-entrypoint-initdb.d/migrations.sh:ro
    shm_size: "256mb"

  redis-test:
    image: redis:alpine
    user: 1000:1000
    cap_drop:
      - all
    security_opt:
      - no-new-privileges
    networks:
      default:
        ipv4_address: 10.114.116.114
    command: 'redis-server --appendonly no --save ""'

networks:
  default:
    driver: bridge
    ipam:
      config:
        - subnet: 10.114.116.0/24
          gateway: 10.114.116.1
